# [Algorithmic Marketing] 온라인 광고


온라인 광고를 하는 과정과 애트리뷰션 모델에 대해 알아보자.

<!--more-->

## 온라인 광고
먼저 온라인 광고 환경을 구성하는 개체들을 알아보자.
- 브랜드 (마케터)
    - 제품이나 서비스를 판매
    - 광고 캠페인에 자금을 투자
- 광고주 (에이전시)
    - 브랜드를 대신해 광고 캠페인을 운영
    - 여러 채널(웹 배너, 검색 결과 페이지, 온라인 비디오 광고 등)을 통해 브랜드의 고객을 늘리는 것이 주 목표
- 광고 거래소
    - 퍼블리셔들과 광고주들은 광고 거래소에 의해 연결
    - 광고 인벤토리가 생기면 퍼블리셔들로부터 광고요청을 받고 이 요청들을 광고주들에게 분배
    - 거래소는 광고요청을 실시간으로 처리하는 형태를 가지므로 실시간 입찰 (real time bidding, RTB) 프로세스를 진행
- 사용자
    - 채널을 통해 광고를 보는 사람
    - 광고에 노출되는 것은 임프레션(impression)이라고 함
- 애트리뷰션 시스템
    - impression과 conversion을 측정
    - 사용자를 행적을 추적하여 광고 캠페인의 효율성을 측정

## 목표
- 브랜드의 목표
    - 브랜드 인지
    - 신규 고객 유치
    - 리타겟팅

브랜드의 관점에서 캠페인의 전반적 효율은 신규 고객당 비용 (cost per acquistition, CPA)에 의해 측정된다. CPA는 캠페인 비용을 전체 conversion 수로 나누것이다.

$$CPA = \frac{C_camp}{N_conv}$$

이 때, 캠페인 비용은 알기 쉽지만 conversion은 정의하기 나름이다. 예를 들어, post-view action 방법이 있다. 이는 광고에 노출된 이후 특정 기간 동안 브랜드 웹 사이트를 방문하거나 구매한 사용자 수를 세는 것을 의미한다. 더 간단하게는 광고의 클릭 횟수를 세는 것이고 이를 cost per click (CPC) 모델이라고 한다. 광고주의 입장에서는 impression 횟수와 impression당 비용을 곱으로 CPA를 생각한다.

$$CPA = \frac{N_{impr}\cdot E[c_{impr}]}{N_{conv}} = \frac{1}{CR}\cdot E[c_{impr}]$$

여기서 광고주의 마진은 RTB에서 정해진 입찰 가격을 빼야하므로 아래의 식이 성립한다.

$$CPA_a = \frac{1}{CR}\cdot E[c_{impr} - c_{bid}]$$

브랜드가 내는 $c_{impr}$의 경우 주로 두 가지 종류의 계약이 사용된다고 한다. (여기서 애트리뷰션은 브랜드가 측정한다고 가정)
- 액션당 가격 (Cost per action): 애트리뷰션 시스템에 의해 측정된 컨버전마다 정해진 비용을 지불
- 노출당 가격 (Cost per mile, CPM): impression마다 정해진 비용을 지불하지만 애트리뷰션 시스템을 통해 전체적 CPA를 측정

광고주는 $CPA$ 최소화하는게 고객만족이므로 이를 위해 $CR$을 최대화하다. $CPA_a$는 $c_{bid}$가 고정되지 않고 conversion 비율의 영향을 받기 때문에 $CR$과 $c_{bid}$의 동시 최적화가 필요하다.

## Attribution model
### CPA-LT 모델
그렇다면 여러 광고주가 있을 경우 애트리뷰션을 어떻게 봐야할까? 이또한 다양한 방법들이 존재한다. 가장 기본적인 방법은 마지막 impression에 모든 공을 돌리는 Last touch attribution (LT) 이다. 위에서 살펴본 CPA와 LT가정을 갖는게 CPA-LT 모델이다.
- CPA-LT 모델의 한계점
    - 브랜드 인지, 고객 유치 보다는 리타겟팅에 치우쳐진다.
    - impression없이도 conversion될 고객을 인지하는 타겟팅은 CPA-LT 모델에서는 좋은 성과를 내지만 ROI측면에서는 아니다.
    - 광고주가 속임수를 쓸 수 있다.

이제부터 CPA-LT 모델에서 어떻게 타겟팅과 입찰전략을 최적화할 것인지 알아보자.

### CPA-LT 모델 타겟팅
CPA-LT 모델에서 타겟팅의 목표는 광고 노출 직후에 conversion할 것 같은 고객을 인지하는 것이다. 광고에 대한 사용자의 반응에 대한 정보를 사용한다. 추가로 현재 진행 중인 광고의 성과를 반영하여 타겟팅 방법을 동적으로 수정한다. 여기서 광고주는 아래와 같은 데이터를 갖고 있다고 가정한다.
- 방문 URL
- 사용자 특성 (디바이스, 앱, 페이지 사용 시간 등)
- bid, impression
- 어떻게 사용자가 광고에 노출되었는지
- conversion, 브랜드 데이터 (사용자가 브랜드의 어떤 데이터를 봤는지)

이러한 데이터를 통해 예측 모델링을 진행하는 것이다. 여러가지 방법들 중에 하나를 알아보자. Perlich 등이 제안한 단계별 타겟팅 방법론이다. 이 방법은 타겟팅 프로세스를 3단계로 나눠서 진행하는 것이다.

### 브랜드 근접성
- 사용자 $u$에 대한 브랜드 근접성 (brand proximity) $P(Y|u)$를 계산하기 위해 광고 효과에 상관없이 conversion $Y$의 확률을 추정
    - conversion될 확률이 높을수록 브랜드에 가깝다고 판단
- 캠페인 이전의 데이터를 이용하여 브랜드 사이트 방문자의 conversion 여부로 target값 설정
- 실제 광고 응답에 대한 데이터가 없는 캠페인 초기에 사용자를 스코어링하기 위해 사용가능
- 주로 URL을 사용한다고 한다.
    - 아래식에서 $URL_i$을 방문했으면 1, 아니면 0

$$\phi(u) = P(Y|u) = P(Y|URL_1,...,URL_n)$$

### 광고 응답 모델링
- 추가로 광고 $a$에 대한 조건적 conversion 확률 $P(Y|u,a)$를 추정하는 것
    - 해당 광고에 응답했는지 여부를 분류
- 단순히 URL이 아니라 위의 결과를 feature로 사용하고 그 외 사용자의 추가적인 정보를 이용하여 모델링한다.

$$\Phi_a(u) = P(Y|u,a)=P(Y|\phi_{u1},...,\phi_{uk},f_{u1},...,f_{ur})$$

### 인벤토리 품질과 입찰
- 마지막 단계로 광고거래소에 제출될 입찰 가격을 정하는 것이다.
- 최적 입찰 가격은 아래 식처럼 conversion 가치 $v(Y)$의 기댓값으로 계산된다.
    - $v(Y)$는 모든 사용자에 대한 상수로 가정

$$b_{opt} = E[v(Y)] = P(Y|u,a)\cdot v(Y)$$

- 모델 $\Phi$를 이용하여 입찰을 결정할 수도 있다. 특정 사용자에 대한 입찰 가격은 아래와 같다.
    - $s_1$은 수치를 변환하는 함수

$$b(u) = b_{base} \cdot s_1(\Phi_a(u))$$

- 그런데 지금까지의 타겟팅 과정은 impression의 맥락이 되는 인벤토리를 고려하지 않는다.
- 인벤토리 $i$일 때, 확률 $w_a(u,i) = P(Y|u,a,i)$를 사용할 수 있다.

$$b(u) = b_{base} \cdot s_1(\Phi_a(u)) \cdot s_2 (\frac{w_a(u,i)}{w_a(u)})$$

## Reference
- 알고리즘 마케팅
